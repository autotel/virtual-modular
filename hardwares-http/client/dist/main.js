!function(t){var e={};function n(o){if(e[o])return e[o].exports;var i=e[o]={i:o,l:!1,exports:{}};return t[o].call(i.exports,i,i.exports,n),i.l=!0,i.exports}n.m=t,n.c=e,n.d=function(t,e,o){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(o,i,function(e){return t[e]}.bind(null,i));return o},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e){t.exports={black:"#000",background:"transparent",lines:"#0c76d3",highlights:"#ce1879",highlights:"#0c76d3"}},function(t,e,n){var o=n(0),i=n(10);t.exports=function(t,e){i.call(this,t,e);var n=t.forceLayout,s=this;if(this.forceNode=n.getOrMakeNode(e,function(t){return t.unique==e.unique}),this.messageOut=function(t,e){var n=s.forceNode.getLinkTo(t.sprite.forceNode);n?n.highlight():console.warn("couldn't find a link to highlight")},e.draggable=!0,e.name){var r=new Konva.Text({x:10,y:-12,rotation:-30,text:e.name,fill:o.lines});this.K.add(r)}this.connectTo=function(t){s.forceNode.connectTo(t.forceNode)},this.disconnectTo=function(t){s.forceNode.disconnectTo(t.forceNode)},this.applyChanges=function(t){},this.update=function(t){(t.type="tick")&&(s.K.setX(s.forceNode.x),s.K.setY(s.forceNode.y))},this.forceNode.tickFunction=function(t){s.update(t)}}},function(t,e){t.exports=function(){var t=this,e=function(t){this.callback=t};this.ons||(this.ons=[]),this.on=function(n,o){if(n=n.split(" "),"function"!=typeof o)throw"error at mouse.on, provided callback that is not a function";if(0==n.length)throw"sorry, you gave an invalid event name";if(n.length>0){var i=new e(o);for(var s of n)t.ons[s]||(t.ons[s]=[]),t.ons[s].push(i);return i}},this.off=function(n){if("string"==typeof n){var o=n.split(" ");for(var n of o)this.ons[n]=[]}else{if(!(n instanceof e))throw n;for(var i in t.ons)for(var s in t.ons[i])n===t.ons[i][s]&&t.ons[i].splice(s,1)}},this.handle=function(e,n){if(t.ons[e])for(var o in t.ons[e])t.ons[e][o].callback(n)}}},function(t,e,n){var o=n(0),i=n(1);const s=2*Math.PI;t.exports=function(t,e){this.node=e.node;i.call(this,t,e);var n=0,r=16,a=[],c=new Konva.Group,u=new Konva.Line({x:0,y:0,points:[0,35,0,20],stroke:o.lines,strokeWidth:1});function d(t){if(0!=(r=Math.min(16,t))){for(var e=40,n=0;n<t;n++){a[n]?a[n].setAttr("visible",!0):(a[n]=new Konva.Circle({radius:5,fill:"transparent",stroke:o.lines,strokeWidth:1}),c.add(a[n])),t;var i=n/r%1;a[n].setX(Math.sin(i*s)*e),a[n].setY(Math.cos(i*s)*e),t>16&&(e-=.5)}for(n=t;n<a.length;n++)a[n].setAttr("visible",!1)}}function l(t){!function(t){for(var e=0;e<a.length;e++)t(a[e],e)}(function(e,n){1<<n&t?e.setAttr("fill",o.highlights):e.setAttr("fill","transparent")})}this.K.add(c),this.K.add(u),d(16),this.applyChanges=function(t){t.steps&&d(t.steps),null!==t.bitmap&&l(t.bitmap),t.step&&(n=t.step,c.setAttr("rotation",360*n/r),0)};var h={x:0,y:0};h.x=100*Math.random(),h.y=100*Math.random(),this.K.setX(h.x),this.K.setY(h.y);this.update}},function(t,e,n){"use strict";var o=n(2),i=new function(){o.call(this);var t=this,e=function(t){var n=this,o=e.environment;this.properties=t,this.reset=function(t){this.properties=t,o.handle("modulereset",{module:n})},this.connectTo=function(t){t.properties?(console.log(n.properties.name,"---\x3e",t.properties.name),o.handle("+connection",{origin:n,destination:t})):console.warn(n,"-!->",t)},this.disconnectTo=function(t){t.properties?(console.log(n.properties.name,"-X->",t.properties.name),o.handle("-connection",{origin:n,destination:t})):console.warn(n,"X!->",t)},o.handle("+module",{module:n}),e.list.push(this)};e.list=[],e.getByUnique=function(n,o){for(var i of e.list)if(i.properties.unique===n)return i;return console.log("sprite unique not found.",n),!!o&&(t.addModule({type:"placeholder",unique:n,name:""}),e.getByUnique(n))},e.delete=function(n){t.handle("-module",{module:n}),console.log("DEL",n),n.properties.unique=void 0;var o=e.list.indexOf(n);-1!==o?e.list.splice(o,1):console.warn("!DEL")},e.environment=this;var n=this.modules=new Set;this.plugins={};var i=this;return this.use=function(t){console.log("using",t.name),this.plugins[t.name]=new t(i)},this.addModule=function(t){var o=e.getByUnique(t.unique,!1);o&&e.delete(o),n.add(new e(t))},this.changeModule=function(n){var o=e.getByUnique(n.origin,!1);o?(n.module=o,t.handle("~module",n)):console.warn("module change error: uid "+n.unique+" doesn't exist")},this.removeModule=function(t){var n=e.getByUnique(t.origin,!1);n?e.delete(n):console.warn("module deletion error: uid "+t.unique+" doesn't exist")},this.connect=function(t){e.getByUnique(t.origin,!0).connectTo(e.getByUnique(t.destination,!0))},this.disconnect=function(t){e.getByUnique(t.origin,!0).disconnectTo(e.getByUnique(t.destination,!0))},this.makeEventMessageEvent=function(n){var o=e.getByUnique(n.origin,!0),i=e.getByUnique(n.destination,!0);o&&i?t.handle(">message",{origin:o,destination:i,value:n.val}):console.warn("message could not be attributed to any module",n)},this.start=function(){console.log("graphics start"),i.handle("start")},this};i.use(n(5)),i.use(n(7)),i.start()},function(t,e,n){"use strict";var o=n(2),i=new(n(6)),s=(i.compress,i.decompress);t.exports=function(t){o.call(this);var e=this,n=io();n.on("message",function(t){(t=s(t)).type?(e.handle(t.type,t),i[t.type]?i[t.type](t):console.log("-no procedure for",t.type)):console.log("received malformed message",t)}),n.on("emittest",console.log),this.testMessage=function(t){n.send("test",t)};var i={start:function(){t.handle("serverstart")},"+module":function(e){t.addModule(e)},"-module":function(e){t.removeModule(e)},"~module":function(e){t.changeModule(e)},"+connection":function(e){t.connect(e)},"-connection":function(e){t.disconnect(e)},">message":function(e){t.makeEventMessageEvent(e)}};return this}},function(t,e,n){"use strict";var o=n(2),i=[{header:"start"},{header:"+module",attributes:["unique","name","kind"],compress:{},decompress:{}},{header:"-module",attributes:["origin"],compress:{},decompress:{}},{header:"~module",attributes:["origin","steps","step","bitmap"],compress:{},decompress:{}},{header:"select_module",attributes:["origin"],compress:{},decompress:{}},{header:"deselect_module",attributes:["origin"],compress:{},decompress:{}},{header:"focus_module",attributes:["origin"],compress:{},decompress:{}},{header:"defocus module",attributes:["origin"],compress:{},decompress:{}},{header:">message",attributes:["origin","destination","val"],compress:{val:function(t){return Array.from(t.value)}},decompress:{val:function(t){return Array.from(t.value)}}},{header:"+connection",attributes:["origin","destination"],compress:{},decompress:{}},{header:"-connection",attributes:["origin","destination"],compress:{},decompress:{}}],s={};for(var r in i)s[i[r].header]=r;t.exports=function(t){o.call(this),this.compress=function(t){var e=t.type,n=s[e],o=i[n],r=[parseInt(n)];if(!o)return console.error("data structure of the message is",o,t),t;if(o.attributes)for(var a of o.attributes)"function"==typeof o.compress[a]?r.push(o.compress[a](t[a])):r.push(t[a]);return r},this.decompress=function(t){var e={},n=(t=Array.from(t)).shift(),o=i[n];if(!o)return console.error("data structure of the message is",o,readableMessage),t;var s=o.header;for(var r in e.type=s,o.attributes)"function"==typeof o.decompress[r]?e[o.attributes[r]]=o.decompress[r](t[r]):e[o.attributes[r]]=t[r];return e}}},function(t,e,n){n(8);var o=n(9),i=n(17);t.exports=function(t){var e=this;window.onload=function(){e.forceLayout=new i;var n=new Konva.Stage({container:"konva",width:window.innerWidth,height:window.innerHeight}),s=e.konvaLayer=new Konva.Layer;n.add(s);var r=[];new Konva.Animation(function(t){t.time,t.timeDiff,t.frameRate},s).start(),t.on("serverstart",function(){for(var t of r);}),t.on("modulereset",function(t){var e=t.module;e.sprite&&e.sprite.remove()}),t.on("+module",function(t){console.log("+module");var n,i=t.module;r[i.properties.unique]&&r[i.properties.unique].remove(),o[i.properties.kind]?n=new o[i.properties.kind](e,i.properties):(console.log("No "+i.properties.kind+" module sprite, using generic",o),console.log(t),n=new o.TestModule(e,i.properties)),r[i.properties.unique]=n,i.sprite=n}),t.on("-module",function(t){console.log("-module");var e=t.module;r[e.properties.unique].remove()}),t.on("~module",function(t){var e=t.module;r[e.properties.unique].applyChanges(t)}),t.on("+connection",function(t){console.log("+connection"),t.origin.sprite.connectTo(t.destination.sprite)}),t.on("-connection",function(t){console.log("+connection"),t.origin.sprite.disconnectTo(t.destination.sprite)}),t.on(">message",function(t){try{t.origin.sprite.messageOut(t.destination,t.value),t.destination.sprite.messageIn&&t.destination.sprite.messageIn(t.origin,t.value)}catch(e){console.warn("on >message event, event.destination.sprite.messageOut doesn't exist",t),console.error(e)}})}}},function(t,e,n){var o=n(2);requestAnimationFrame(function t(e){requestAnimationFrame(t)}),t.exports=function(){o.call(this);let t=this,e=window,n=document;n.documentElement,n.getElementsByTagName("body")[0];function i(){t.width=e.innerWidth,t.height=e.innerHeight}return this.width=0,this.height=0,this.scroll={x:0,y:0},i(),n.addEventListener("scroll",function(e){t.scroll.x=e.pageX,t.scroll.y=e.pageY,t.handle("scroll",e)}),e.onresize=function(e){i(),t.handle("resize",e)},this.mouse=new function(){o.call(this),console.log("MOUS#");var t=this;this.x=0,this.y=0,this.buttonsPressed=[!1,!1,!1,!1],e.addEventListener("move",function(e){t.x=event.clientX,t.y=event.clientY},!1),document.addEventListener("mousedown",function(e){t.buttonsPressed[e.button]=!0}),document.addEventListener("mouseup",function(e){t.buttonsPressed[e.button]=!1})},console.log("MIOS"),this}},function(t,e,n){t.exports={Module:n(1),TestModule:n(11),Sequencer:n(3),Arpeggiator:n(12),Narp:n(13),MidiIO:n(14),DelayClockBased:n(3),RouteSequencer:n(3),PresetKit:n(16)}},function(t,e,n){n(0);t.exports=function(t,e){var n=t.konvaLayer,o=this;this.K=new Konva.Group,n.add(this.K),this.place=function(t){t.x&&this.K.setX(t.x),t.y&&this.K.setY(t.y)},this.update=function(){},this.remove=function(){o.K.destroy()}}},function(t,e,n){var o=n(0),i=n(1);t.exports=function(t,e){this.node=e.node;i.call(this,t,e);Math.random();var n=new Konva.Circle({x:0,y:0,radius:5,fill:"transparent",stroke:o.lines,strokeWidth:1});this.K.add(n);var s={x:0,y:0};s.x=100*Math.random(),s.y=100*Math.random(),this.K.setX(s.x),this.K.setY(s.y);var r=this.update;this.update=function(t){r(t),t.type}}},function(t,e,n){var o=n(0),i=n(1);const s=2*Math.PI;t.exports=function(t,e){this.node=e.node;i.call(this,t,e);Math.random();var n=0,r=new Konva.Group,a=0;this.K.add(r);var c=[];function u(t){n=t;for(var e=0;e<t;e++){c[e]?c[e].setAttr("visible",!0):(c[e]=new Konva.Circle({radius:5,fill:"transparent",stroke:o.lines,strokeWidth:1}),r.add(c[e]));var i=e/t,a=4*t;c[e].setX(Math.sin(i*s)*a),c[e].setY(Math.cos(i*s)*a)}for(e=t;e<c.length;e++)c[e].setAttr("visible",!1)}u(0),this.applyChanges=function(t){void 0!==t.steps&&u(t.steps)},this.messageIn=function(t,e){0==e[0]&&n>0&&(a--,r.setAttr("rotation",3/n*a))};var d={x:0,y:0};d.x=100*Math.random(),d.y=100*Math.random(),this.K.setX(d.x),this.K.setY(d.y);this.update}},function(t,e,n){var o=n(0),i=n(1);const s=2*Math.PI;t.exports=function(t,e){this.node=e.node;i.call(this,t,e);Math.random();var n=0,r=new Konva.Group,a=0;this.K.add(r);var c=[];function u(t){n=t;for(var e=22,i=0;i<t;i++){c[i]?c[i].setAttr("visible",!0):(c[i]=new Konva.Circle({radius:5,fill:"transparent",stroke:o.lines,strokeWidth:1}),r.add(c[i]));var a=i/t;e=4*t,c[i].setX(Math.sin(a*s)*e),c[i].setY(Math.cos(a*s)*e)}for(i=t;i<c.length;i++)c[i].setAttr("visible",!1)}u(0),this.applyChanges=function(t){void 0!==t.steps&&u(t.steps)},this.messageIn=function(t,e){0==e[0]&&n>0&&(a--,r.setAttr("rotation",3/n*a))};var d={x:0,y:0};d.x=100*Math.random(),d.y=100*Math.random(),this.K.setX(d.x),this.K.setY(d.y);this.update}},function(t,e,n){var o=n(0),i=n(1);t.exports=function(t,e){this.node=e.node;i.call(this,t,e);var n=new Konva.Circle({x:0,y:0,radius:10,fill:"transparent",stroke:o.lines,strokeWidth:1});this.K.on("mouseenter",function(){console.log("mouseenter")}),this.K.add(n);var s=0,r=0;e.position&&this.place(e.position),this.messageIn=function(t,e){r+=.4};var a=this.update;this.update=function(t){"clock"==t.type&&(s+=r,s%=30,t.absTime,a(t),n.setAttr("radius",s),n.setAttr("opacity",r)),r=Math.floor(1e3*r*.9)/1e3}}},,function(t,e,n){var o=n(0),i=n(1);Math.PI;t.exports=function(t,e){this.node=e.node;i.call(this,t,e);var n=this,s=window.innerWidth/2,r=window.innerHeight/2,a=[],c=new Konva.Group,u=new Konva.Line({x:0,y:0,points:[0,35,0,20],stroke:o.lines,strokeWidth:1});function d(t){if(0!=Math.min(16,t)){for(var e=10,n=0;n<t;n++)a[n]?a[n].setAttr("visible",!0):(a[n]=new Konva.Circle({radius:5,fill:"transparent",stroke:o.lines,strokeWidth:1}),c.add(a[n])),t,a[n].setX(n%4*e),a[n].setY(Math.floor(n/4)*e),t>16&&(e-=.5);for(n=t;n<a.length;n++)a[n].setAttr("visible",!1)}}function l(t){!function(t){for(var e=0;e<a.length;e++)t(a[e],e)}(function(e,n){1<<n&t?e.setAttr("fill",o.highlights):e.setAttr("fill","transparent")})}this.K.add(c),this.K.add(u),d(16),this.applyChanges=function(t){t.steps&&d(t.steps),null!==t.bitmap&&l(t.bitmap)};var h={x:0,y:0};h.x=100*Math.random(),h.y=100*Math.random(),this.K.setX(h.x),this.K.setY(h.y);var f={x:h.x,y:h.y},p=this.update;this.update=function(t){p(t);var e=n.K.position();Math.abs(f.x-e.x)+Math.abs(f.y-e.y)>=1&&n.K.rotation(180*Math.atan2(e.x-s,e.y-r)/Math.PI),f=e}}},function(t,e,n){"use strict";var o={linkDistance:70,linkStrength:1,charge:-1e3,chargeDistance:900};t.exports=function(){var t=this,e=window.innerWidth,n=window.innerHeight,i=(d3.scale.category20(),d3.layout.force().size([e,n]).nodes([]).on("tick",l));console.log(i);var s=d3.select("body").append("svg").attr("width",e).attr("height",n).on("mousemove",function(){u.attr("transform","translate("+d3.mouse(this)+")")}).on("mousedown",function(){d3.mouse(this)}),r=i.nodes(),a=(i.links(),s.selectAll(".node")),c=s.selectAll(".link"),u=s.append("circle").attr("r",30).attr("transform","translate(-100,-100)").attr("class","cursor");h();function d(t,e){t.grasa=10,console.log(e,t),h()}function l(t){c.attr("d",function(t){var e=t.target.x-t.source.x,n=t.target.y-t.source.y,o=Math.sqrt(e*e+n*n)*t.h/2;return"M"+t.source.x+","+t.source.y+"A"+o+","+-o+" 0 0,1 "+t.target.x+","+t.target.y}),a.attr("cx",function(t){return t.x}).attr("cy",function(t){return t.y})}function h(){(a=a.data(r)).enter().insert("circle",".cursor").attr("class","node").attr("r",5).on("mousedown",d),a.exit().remove();var t=[];for(var e of r)for(var n of(e.links=[],e.outputs)){var s=new function(){var t=this;this.source=e,this.target=n,this.h=0,this.off=0,this.highlight=function(){t.h=5},this.tickFunction=function(){t.h>0&&t.h--}};t.push(s),e.links.push(s)}c=c.data(t),i.nodes(r).links(t).linkDistance(o.linkDistance).linkStrength(o.linkStrength).charge(o.charge).chargeDistance(o.chargeDistance),c.enter().insert("path",".node").attr("class","link"),c.exit().remove(),i.start()}return this.addNode=function(t){var e=new function(t){t=t||{};var e=this;for(var n in t)e[n]=t[n];var o=this.outputs=new Set;e.connectTo=function(t){o.add(t),h()},e.disconnectTo=function(t){o.delete(t),h()},this.links=[],e.getLinkTo=function(t){for(var n of e.links)if(n.target==t)return n;return!1},e.tickFunction=function(t){}}(t);return r.push(e),h(),e},this.getOrMakeNode=function(e,n){for(var o in r)if(n(r[o]))return r[o];return t.addNode(e)},this.removeNode=function(t){var e=t,n=r.indexOf(e);return console.log("remove"),-1!==n&&r.splice(n,1)},this.nodeHighlight=function(t){t.grasa<20&&(t.grasa+=2)},this.rebuild=h,function t(e){requestAnimationFrame(t),l(),a.each(function(t){t.tickFunction({type:"clock",absTime:e})}),a.attr("r",function(t){return t.grasa||(t.grasa=5),t.grasa>5&&t.grasa--,t.grasa}),c.each(function(t){t.tickFunction({type:"clock",absTime:e})}).style("stroke-width",function(t){return(1+t.h)/4})}(),this}}]);